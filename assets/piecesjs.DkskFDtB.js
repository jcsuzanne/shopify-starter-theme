const h=async(r,e,t=document)=>{t.getElementsByTagName(r).length>0&&await e()},c=r=>{var e=Object.prototype.toString.call(r);return typeof r=="object"&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(e)&&typeof r.length=="number"&&(r.length===0||typeof r[0]=="object"&&r[0].nodeType>0)};class o{constructor(){this.piecesCount=0,this.currentPieces={}}addPiece(e){typeof this.currentPieces[e.name]!="object"&&(this.currentPieces[e.name]={}),this.currentPieces[e.name][e.id]=e}removePiece(e){delete this.currentPieces[e.name][e.id]}}let l=new o;class u extends HTMLElement{constructor(e,{stylesheets:t=[]}={}){super(),this.name=e,this.template=document.createElement("template"),this.piecesManager=l,this.stylesheets=t,this.innerHTML!=""&&(this.baseHTML=this.innerHTML)}connectedCallback(e=!0){e&&(typeof this.cid=="string"?this.cid=this.cid:this.cid=`c${this.piecesManager.piecesCount++}`,this.piecesManager.addPiece({name:this.name,id:this.cid,piece:this})),this.privatePremount(e),this.baseHTML==null&&(this.innerHTML="",this.template.innerHTML=this.render()!=null?this.render():"",this.appendChild(this.template.cloneNode(!0).content)),this.privateMount(e)}render(){if(this.baseHTML!=null)return this.baseHTML}disconnectedCallback(){this.privateUnmount()}adoptedCallback(){}privatePremount(e=!0){this.baseHTML==null&&(this.innerHTML=""),this.log&&console.log("🚧 premount",this.name),this.loadStyles(e),this.premount(e)}premount(e=!0){}privateMount(e){this.log&&console.log("✅ mount",this.name),this.mount(e)}mount(e=!0){}privateUpdate(){this.log&&console.log("🔃 update",this.name),this.privateUnmount(!0),this.connectedCallback(!1)}update(){}privateUnmount(e=!1){e||this.piecesManager.removePiece({name:this.name,id:this.cid}),this.log&&console.log("❌ unmount",this.name),this.unmount(e)}unmount(e=!1){}attributeChangedCallback(e,t,i){t!==i&&(this[e]=i,this.privateUpdate())}$(e,t=this){return t.querySelectorAll(e)}dom(e,t=this){return t.querySelectorAll(e)}domAttr(e,t=this){return t.querySelectorAll(`[data-dom="${e}"]`)}captureTree(e=this){const t=this.querySelectorAll("[data-dom]");let i={};for(let s of t){const n=s.getAttribute("data-dom");typeof i[n]>"u"&&(i[n]=[]),i[n].push(s)}return i}on(e,t,i,s=null){t!=null&&(c(t)?t.length>0&&t.forEach(n=>{s==null?n.addEventListener(e,i.bind(this)):n.addEventListener(e,i.bind(this,s))}):s==null?t.addEventListener(e,i.bind(this)):t.addEventListener(e,i.bind(this,s)))}off(e,t,i){t!=null&&(c(t)?t.length>0&&t.forEach(s=>{s.removeEventListener(e,i.bind(this))}):t.removeEventListener(e,i.bind(this)))}emit(e,t=document,i){const s=new CustomEvent(e,{detail:i});t.dispatchEvent(s)}call(e,t,i,s){Object.keys(this.piecesManager.currentPieces).forEach(n=>{n==i&&Object.keys(this.piecesManager.currentPieces[n]).forEach(a=>{s!=null?a==s&&this.piecesManager.currentPieces[n][a].piece[e](t):this.piecesManager.currentPieces[n][a].piece[e](t)})})}async loadStyles(e=!0){if(e)for(let t=0;t<this.stylesheets.length;t++)await this.stylesheets[t]()}get log(){return typeof this.getAttribute("log")=="string"}get cid(){return this.getAttribute("cid")}set cid(e){return this.setAttribute("cid",e)}get properties(){return Object.values(this.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")}}export{u as d,h as u};
